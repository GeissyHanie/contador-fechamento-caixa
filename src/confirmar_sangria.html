<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Controle de Caixa | Doces e Mimos</title>
    <link rel="stylesheet" href="confirmar_sangria.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="sangria-body">

    <header class="header-center">
        <img src="../assets/Doces e Mimos.png" class="logo-solo" alt="Logo">
        <h1 class="titulo-controle">Controle de Caixa</h1>
        <div class="pill-operacao">
            <span class="icon-cash">üìü</span> Opera√ß√£o de Sangria (Retirada)
        </div>
    </header>

    <main class="container-central">
        <section class="card-confirmacao">
            <div class="top-gradient-bar"></div>
            
            <h2 class="form-title">Nova Sangria</h2>
            <p class="form-subtitle">Registre a retirada de dinheiro do caixa com do√ßura e seguran√ßa! üç¨</p>

            <form id="form-sangria">
                <div class="input-group">
                    <label>Valor da Retirada 01 (R$)</label>
                    <div class="input-with-icon">
                        <span class="currency-prefix">R$</span>
                        <input type="number" placeholder="0,00" step="0.01" class="input-valor">
                        <span class="icon-input">üíµ</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>Motivo da Sangria 01</label>
                    <select class="custom-select" id="motivo-1">
                        <option value="">Selecione o motivo...</option>
                        <option value="Pagamento de Fornecedor">Pagamento de Fornecedor</option>
                        <option value="Despesa Extra">Despesa Extra</option>
                        <option value="Reposi√ß√£o de Troco">Reposi√ß√£o de Troco</option>
                        <option value="Valor excedente">Valor em caixa excedendo limite</option>
                    </select>
                </div>

                <hr class="divider">

                <div class="input-group">
                    <label>Valor da Retirada 02 (R$)</label>
                    <div class="input-with-icon">
                        <span class="currency-prefix">R$</span>
                        <input type="number" placeholder="0,00" step="0.01" class="input-valor">
                        <span class="icon-input">üíµ</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>Motivo da Sangria 02</label>
                    <select class="custom-select" id="motivo-2">
                        <option value="">Selecione o motivo...</option>
                        <option value="Pagamento de Fornecedor">Pagamento de Fornecedor</option>
                        <option value="Despesa Extra">Despesa Extra</option>
                        <option value="Reposi√ß√£o de Troco">Reposi√ß√£o de Troco</option>
                        <option value="Valor excedente">Valor em caixa excedendo limite</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Observa√ß√£o (Opcional)</label>
                    <textarea id="obs-texto" placeholder="Detalhes adicionais sobre a retirada..." rows="3"></textarea>
                </div>

                <div class="actions-form">
                    <button type="button" class="btn-cancelar" onclick="window.history.back()">‚úï Cancelar</button>
                    <button type="submit" class="btn-confirmar-final">‚úî Confirmar Sangria</button>
                </div>
            </form>
        </section>

        <footer class="footer-stats">
            <div class="stat-box saldo-box">
                <small>SALDO ATUAL</small>
                <strong>R$ 1.250,00</strong>
            </div>
            <div class="stat-box retirado-box">
                <small>TOTAL RETIRADO</small>
                <strong class="text-pink">- R$ 0,00</strong>
            </div>
        </footer>
    </main>

    <p class="copyright">¬© 2024 Doces e Mimos System<br>üìñ Manual ¬∑ üéß Suporte</p>

    <script>
    const inputsValor = document.querySelectorAll('.input-valor');
    const totalDisplay = document.querySelector('.retirado-box strong');
    const form = document.getElementById('form-sangria');

    // 1. Fun√ß√£o que soma os valores em tempo real
    function atualizarTotalFinal() {
        let soma = 0;
        inputsValor.forEach(input => {
            soma += parseFloat(input.value) || 0;
        });
        const totalFormatado = `R$ ${soma.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        totalDisplay.innerText = `- ${totalFormatado}`;
    }

    inputsValor.forEach(input => {
        input.addEventListener('input', atualizarTotalFinal);
    });

    // 2. Fun√ß√£o que SALVA TUDO e vai para a pr√≥xima tela
    form.addEventListener('submit', function(e) {
        e.preventDefault(); 

        // Pega o valor total que est√° aparecendo na tela
        const valorTotalSalvar = totalDisplay.innerText.replace('- ', '');

        // Pega os textos dos motivos e observa√ß√£o
        const mot1 = document.getElementById('motivo-1').value;
        const mot2 = document.getElementById('motivo-2').value;
        const obs = document.getElementById('obs-texto').value;

        // Monta uma frase organizada para o relat√≥rio
        let textoRelatorio = "";
        if(mot1) textoRelatorio += "Motivo 1: " + mot1 + ". ";
        if(mot2) textoRelatorio += "Motivo 2: " + mot2 + ". ";
        if(obs)  textoRelatorio += "Obs: " + obs;
        if(!mot1 && !mot2 && !obs) textoRelatorio = "Nenhuma observa√ß√£o informada.";

        // SALVA NA GAVETA (LocalStorage)
        localStorage.setItem('totalUltimaSangria', valorTotalSalvar);
        localStorage.setItem('obsUltimaSangria', textoRelatorio);

        // VAI PARA A TELA DE SUCESSO
        window.location.href = 'sucesso_sangria.html';
    });
    </script>
</body>
</html>