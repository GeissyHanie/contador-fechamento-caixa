<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fechamento Conclu√≠do | Doces e Mimos</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="fechamento_concluido.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body class="concluido-body">

    <div class="main-container">
        <div class="success-icon-container">
            <div class="outer-circle">
                <div class="inner-circle">
                    <span class="check-mark">‚úì</span>
                </div>
            </div>
        </div>

        <main class="card-concluido">
            <div class="tag-sucesso">SUCESSO!</div>
            
            <h1 class="titulo-curvo">Fechamento Conclu√≠do!</h1>
            <p class="subtitulo">O caixa do dia foi encerrado com sucesso. Tudo est√° doce e em ordem!</p>

            <section class="resumo-final-box">
                <p class="resumo-label">RESUMO DO FECHAMENTO</p>
                
                <div class="row-stats">
                    <div class="stat-box">
                        <span class="stat-label">Saldo Final</span>
                        <strong class="text-green" id="saldo-final">R$ 0,00</strong>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Diferen√ßa</span>
                        <strong class="text-pink" id="diferenca-valor">R$ 0,00</strong>
                    </div>
                </div>

                <div class="info-rodape">
                    <div class="info-linha">
                        <span>Respons√°vel:</span>
                        <strong id="nome-responsavel">Maria Silva</strong>
                    </div>
                    <div class="info-linha">
                        <span>Data/Hora:</span>
                        <strong id="data-hora-texto">24/10/2023 - 18:45</strong>
                    </div>
                </div>
            </section>

            <div class="botoes-acao">
                <button class="btn-relatorio-branco" onclick="window.location.href='relatorio_caixa.html'">üìÑ Ver Relat√≥rio</button>
                <button class="btn-inicio" onclick="voltarAoInicio()">
                    <span class="icon">‚äû</span> Voltar ao In√≠cio
                </button>
            </div>
        </main>
    </div>

    <script>
        function voltarAoInicio() {
            // Limpa apenas a contagem, mant√©m o login
            localStorage.removeItem('dadosContagem');
            window.location.href = 'dashboard.html';
        }

        window.onload = function() {
            const SALDO_ESPERADO = 1248.50;
            const dados = JSON.parse(localStorage.getItem('dadosContagem')) || {};
            
            // BUSCA O NOME J√Å FORMATADO PELO SCRIPT-LOGIN.JS
            const usuarioLogado = localStorage.getItem('usuarioLogado');
            
            let total = 0;
            for (const valor in dados) {
                total += parseFloat(valor) * dados[valor];
            }

            const diferenca = total - SALDO_ESPERADO;

            // Atualiza Saldo e Diferen√ßa
            document.getElementById('saldo-final').innerText = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            const displayDiff = document.getElementById('diferenca-valor');
            const sinal = diferenca > 0 ? "+ " : (diferenca < 0 ? "- " : "");
            displayDiff.innerText = sinal + Math.abs(diferenca).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            displayDiff.style.color = diferenca >= 0 ? "#2ecc71" : "#e91e63";

            // ATUALIZA O NOME DO RESPONS√ÅVEL COM O NOME DO USU√ÅRIO
            if (usuarioLogado) {
                document.getElementById('nome-responsavel').innerText = usuarioLogado;
            }

            // Atualiza Data e Hora
            const agora = new Date();
            document.getElementById('data-hora-texto').innerText = 
                agora.toLocaleDateString('pt-BR') + " - " + 
                agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'});

            // Efeito Confete
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#ff33cc', '#ffeb3b', '#2ecc71', '#4da3ff']
            });
        };
    </script>
</body>
</html>